(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();let c={},x=null;const i=document.getElementById("sourceText"),g=document.getElementById("targetText"),y=document.getElementById("sourceLanguage"),a=document.getElementById("targetLanguage"),l=document.getElementById("translateBtn"),L=document.getElementById("copyBtn"),v=document.getElementById("errorMessage"),w=document.getElementById("successMessage"),p=document.getElementById("sourceCharCount"),m=document.getElementById("autoDetectTargetToggle"),f=document.getElementById("autoTranslateToggle");naimo.onEnter(async e=>{console.log("æ”¶åˆ°å‚æ•°:",e),await R(),I(),e.hotkeyEmit&&i.value.trim()&&setTimeout(()=>T(),100)});async function b(){console.log("ç¿»è¯‘æ’ä»¶åˆå§‹åŒ–...");const e=window.naimo;await C(),K(),e.log.info("ç¿»è¯‘æ’ä»¶åˆå§‹åŒ–å®Œæˆ")}async function C(){try{const e=window.naimo;if(e&&e.storage){c={secretId:await e.storage.getItem("secretId")||"",secretKey:await e.storage.getItem("secretKey")||"",region:await e.storage.getItem("region")||"ap-chengdu"};const t=localStorage.getItem("translate-ui-settings"),s=t?JSON.parse(t):{};y.value=s.defaultSource||"auto",a.value=s.defaultTarget||"en",m&&(m.checked=s.autoDetectTarget!==!1),f&&(f.checked=s.autoTranslate!==!1)}console.log("è®¾ç½®åŠ è½½å®Œæˆ:",c)}catch(e){console.error("åŠ è½½è®¾ç½®å¤±è´¥:",e),window.naimo?.log?.error("åŠ è½½è®¾ç½®å¤±è´¥",e)}}function d(){try{const e={defaultSource:y.value,defaultTarget:a.value,autoDetectTarget:m?.checked??!0,autoTranslate:f?.checked??!0};localStorage.setItem("translate-ui-settings",JSON.stringify(e))}catch(e){console.error("ä¿å­˜UIè®¾ç½®å¤±è´¥:",e)}}function K(){i.addEventListener("input",()=>{I(),A(),f?.checked?(clearTimeout(x),i.value.trim().length>0&&(x=setTimeout(()=>{T()},1e3))):clearTimeout(x)}),l.addEventListener("click",T),L.addEventListener("click",P),y.addEventListener("change",d),a.addEventListener("change",d),m&&m.addEventListener("change",d),f&&f.addEventListener("change",d),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),T()),(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),z())})}function M(e){if(!e||e.trim().length===0)return"unknown";const t=/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/,s=/[a-zA-Z]/;let r=0,n=0,o=0;for(const E of e)t.test(E)?(r++,o++):s.test(E)?(n++,o++):E.trim().length>0&&o++;if(o===0)return"unknown";const h=r/o,k=n/o;return h>.3?"zh":k>.5?"en":r>0&&n>0?r>=n?"zh":"en":r>0?"zh":n>0?"en":"unknown"}function O(e){e!=="unknown"&&(e==="zh"?a.value!=="en"&&(a.value="en",d()):e==="en"&&a.value!=="zh"&&(a.value="zh",d()))}function A(){const e=i.value.trim();if(e&&m?.checked&&y.value==="auto"){const t=M(e);t!=="unknown"&&O(t)}}async function T(){const e=window.naimo,t=window.translatePluginAPI,s=i.value.trim();if(!s){u("è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬");return}if(await C(),!c.secretId||!c.secretKey){u("è¯·å…ˆåœ¨æ’ä»¶è®¾ç½®ä¸­é…ç½®è…¾è®¯äº‘APIå¯†é’¥");return}S(!0),B();try{if(t&&t.translateText){const r=await t.translateText({sourceText:s,source:y.value,target:a.value,settings:{secretId:c.secretId,secretKey:c.secretKey,region:c.region}});r.success?(D(r.translatedText),L.disabled=!1):(u(r.error||"ç¿»è¯‘å¤±è´¥"),L.disabled=!0)}else u("ç¿»è¯‘åŠŸèƒ½æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ’ä»¶é…ç½®")}catch(r){console.error("ç¿»è¯‘é”™è¯¯:",r),e?.log?.error("ç¿»è¯‘é”™è¯¯",r),u("ç¿»è¯‘æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•")}finally{S(!1)}}function D(e){g.innerHTML=e,g.classList.remove("output-placeholder")}async function P(){try{const e=window.naimo,t=g.textContent?.trim()||"";t&&!g.classList.contains("output-placeholder")&&e&&e.clipboard&&(await e.clipboard.writeText(t),N("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"))}catch(e){console.error("å¤åˆ¶å¤±è´¥:",e),u("å¤åˆ¶å¤±è´¥")}}function z(){i.value="",g.innerHTML='<div class="output-placeholder">ç¿»è¯‘ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>',g.classList.add("output-placeholder"),L.disabled=!0,I(),B()}async function R(){try{const e=window.naimo;if(e&&e.clipboard){const t=await e.clipboard.readText();t&&t.trim()&&(i.value=t.trim(),I(),console.log("ğŸ“‹ ä»å‰ªè´´æ¿åŠ è½½æ–‡æœ¬æˆåŠŸ"))}}catch(e){console.error("ä»å‰ªè´´æ¿åŠ è½½æ–‡æœ¬å¤±è´¥:",e)}}function I(){const e=i.value.length;p.textContent=`${e} / 5000`,e>4500?p.style.color="#ff6b6b":e>4e3?p.style.color="#ffa726":p.style.color="#999"}function S(e){const t=l.querySelector("span");e?(l.disabled=!0,l.classList.add("loading"),t.textContent="ç¿»è¯‘ä¸­..."):(l.disabled=!1,l.classList.remove("loading"),t.textContent="ç¿»è¯‘")}function u(e){v.textContent=e,v.classList.add("show"),setTimeout(()=>{v.classList.remove("show")},5e3)}function N(e){w.textContent=e,w.classList.add("show"),setTimeout(()=>{w.classList.remove("show")},3e3)}function B(){v.classList.remove("show"),w.classList.remove("show")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b();
